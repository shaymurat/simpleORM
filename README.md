# Домашнее задание по теме "Написание примитивной ORM"

Если вы решали старую версию задачи, проверка будет производиться по ней.

Ссылка на старую версию [тут](https://docs.google.com/document/d/1EAMqQdmjo6RadDaytmxnCfiagvE5jXq0aC13vKJ91fU/edit?usp=sharing).

Цель: написать простейшие CRUD функции для взаимодействия с базой данных.

## Задача "Регистрация покупателей":

Подготовка:

Для решения этой задачи вам понадобится код из предыдущей задачи.
Дополните его, следуя пунктам задачи ниже.
Дополните файл ```crud_functions.py```, написав и дополнив в нём следующие
функции:

```initiate_db``` дополните созданием таблицы ```Users```, если она ещё не
создана при помощи SQL запроса. Эта таблица должна содержать следующие поля:
1. ```id``` - целое число, первичный ключ
2. ```username``` - текст (не пустой)
3. ```email``` - текст (не пустой)
4. ```age``` - целое число (не пустой)
5. ```balance``` - целое число (не пустой)

```add_user(username, email, age)```, которая принимает: имя пользователя,
почту и возраст. Данная функция должна добавлять в таблицу ```Users``` вашей
БД запись с переданными данными. Баланс у новых пользователей всегда
равен 1000. Для добавления записей в таблице используйте SQL запрос.

```is_included(username)``` принимает имя пользователя и возвращает ```True```,
если такой пользователь есть в таблице ```Users```, в противном случае
```False```.

Для получения записей используйте SQL запрос.

Изменения в Telegram-бот:
1. Кнопки главного меню дополните кнопкой "```Регистрация```".
2. Напишите новый класс состояний ```RegistrationState``` с следующими
   объектами класса ```State```: ```username```, ```email```, ```age```,
   ```balance``` (по умолчанию 1000).
3. Создайте цепочку изменений состояний ```RegistrationState```.

Фукнции цепочки состояний ```RegistrationState```:

```sign_up(message)```:
1. Оберните её в ```message_handler```, который реагирует на текстовое
   сообщение '```Регистрация```'.
2. Эта функция должна выводить в Telegram-бот сообщение "```Введите имя
   пользователя (только латинский алфавит):```".
3. После ожидать ввода имени в атрибут ```RegistrationState.username``` при
   помощи метода ```set```.

```set_username(message, state)```:
1. Оберните её в ```message_handler```, который реагирует на состояние
   ```RegistrationState.username```.
2. Если пользователя ```message.text``` ещё нет в таблице, то должны
   обновляться данные в состоянии ```username``` на ```message.text```. Далее
   выводится сообщение "```Введите свой email:```" и принимается новое
   состояние ```RegistrationState.email```.
3. Если пользователь с таким ```message.text``` есть в таблице, то выводить
   "```Пользователь существует, введите другое имя```" и запрашивать новое
   состояние для ```RegistrationState.username```.

```set_email(message, state)```:
1. Оберните её в ```message_handler```, который реагирует на состояние
   ```RegistrationState.email```.
2. Эта функция должна обновляться данные в состоянии
   ```RegistrationState.email``` на ```message.text```.
3. Далее выводить сообщение "Введите свой возраст:":
4. После ожидать ввода возраста в атрибут ```RegistrationState.age```.

```set_age(message, state)```:
1. Оберните её в ```message_handler```, который реагирует на состояние
   ```RegistrationState.age```.
2. Эта функция должна обновляться данные в состоянии
   ```RegistrationState.age``` на ```message.text```.
3. Далее брать все данные (```username```, ```email``` и ```age```) из
   состояния и записывать в таблицу ```Users``` при помощи ранее написанной
   crud-функции ```add_user```.
4. В конце завершать приём состояний при помощи метода ```finish()```.

Перед запуском бота пополните вашу таблицу ```Products``` 4 или более
записями для последующего вывода в чате Telegram-бота.

Пример результата выполнения программы:

Машина состояний и таблица ```Users``` в Telegram-bot:

![1](https://static.tildacdn.com/tild3731-6231-4330-b532-356361313536/2024-07-21_21-48-11.png)

![2](https://static.tildacdn.com/tild6538-6163-4730-b562-356330333066/2024-07-21_21-50-26_.png)

Результат в таблице ```Users```:

![Таблица](https://static.tildacdn.com/tild3534-3834-4465-a261-336164366430/2024-07-21_21-51-34.png)

Файлы module_14_5.py, crud_functions.py, а также файл с базой данных и
таблицей Users загрузите на ваш GitHub репозиторий. В решении пришлите
ссылку на него.

Успехов!
